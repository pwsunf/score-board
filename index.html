<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <title>score-board</title>
</head>

<body class="bg-slate-100 text-slate-800">
<div id="app"></div>

<script>
  const { createApp, ref, watch, onMounted } = Vue

  createApp({
    setup () {
      const DEFAULT_PLAYERS = ['김','이','원','안','박','허']
      const STORAGE_KEY = 'score-board-mobile-v2'

      const players = ref([...DEFAULT_PLAYERS])
      const gameStarted = ref(false)

      const createEmptyRounds = () =>
          Array.from({ length: 15 }, (_, rIdx) =>
              players.value.map(() => 0)
          )

      const rounds = ref(createEmptyRounds())

      onMounted(() => {
        const saved = localStorage.getItem(STORAGE_KEY)
        if (saved) {
          const parsed = JSON.parse(saved)
          players.value = parsed.players
          rounds.value = parsed.rounds
          gameStarted.value = parsed.gameStarted
        }
      })

      watch([players, rounds, gameStarted], () => {
        localStorage.setItem(
            STORAGE_KEY,
            JSON.stringify({
              players: players.value,
              rounds: rounds.value,
              gameStarted: gameStarted.value
            })
        )
      }, { deep: true })

      /* setup */
      const addPlayer = () => players.value.push('새플레이어')
      const removePlayer = (idx) => {
        if (players.value.length <= 1) return
        players.value.splice(idx, 1)
      }

      const startGame = () => {
        rounds.value = createEmptyRounds()
        gameStarted.value = true
        window.scrollTo({ top: 0 })
      }

      /* game */
      const update = (r, p, delta) => {
        rounds.value[r][p] += delta
      }

      const roundSum = (round) =>
          round.reduce((a, b) => a + b, 0)

      const playerTotal = (idx) =>
          rounds.value.reduce((s, r) => s + r[idx], 0)

      const resetAll = () => {
        if (!confirm('게임을 종료하고 새로 시작할까요?')) return
        players.value = [...DEFAULT_PLAYERS]
        rounds.value = createEmptyRounds()
        gameStarted.value = false
        localStorage.removeItem(STORAGE_KEY)
      }

      return {
        players,
        rounds,
        gameStarted,
        addPlayer,
        removePlayer,
        startGame,
        update,
        roundSum,
        playerTotal,
        resetAll
      }
    },

    template: `
  <div>
    <div class="sticky top-0 bg-white border-b z-10">
      <h1 class="text-center font-bold py-2">score-board</h1>
    </div>

    <!-- setup -->
    <div v-if="!gameStarted" class="p-3">
      <div class="bg-white rounded-lg p-3">
        <div class="font-semibold mb-2">플레이어 설정</div>

        <div class="flex flex-wrap gap-2 mb-3">
          <div v-for="(p, i) in players" class="flex items-center gap-1">
            <input
              v-model="players[i]"
              class="w-24 border rounded-md text-center py-1"
            />
            <button @click="removePlayer(i)" class="text-rose-500">✕</button>
          </div>
        </div>

        <div class="flex justify-between">
          <button @click="addPlayer" class="text-blue-600 text-sm underline">
            + 플레이어 추가
          </button>
          <button
            @click="startGame"
            class="px-4 py-2 bg-emerald-600 text-white rounded-md"
          >
            게임 시작
          </button>
        </div>
      </div>
    </div>

    <!-- game -->
    <div v-else class="p-2 space-y-3">
      <button
        @click="resetAll"
        class="mx-auto block px-4 py-2 border border-rose-300
               text-rose-600 bg-white rounded-md"
      >
        전체 초기화
      </button>

      <div
        v-for="(round, rIdx) in rounds"
        class="bg-white rounded-lg p-3"
      >
        <div class="font-bold mb-2 text-slate-600">
          {{ rIdx + 1 }} 판
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div
            v-for="(p, pIdx) in players"
            class="border rounded-lg p-2 text-center"
          >
            <div class="text-sm font-semibold mb-1">
              {{ p }}
            </div>

            <input
              type="number"
              inputmode="numeric"
              v-model.number="rounds[rIdx][pIdx]"
              class="w-full h-10 text-center border rounded-md mb-2"
            />

            <div class="flex justify-center gap-3">
              <button
                class="w-10 h-10 rounded-full bg-rose-100 text-rose-600"
                @click="update(rIdx, pIdx, -1)"
              >−</button>
              <button
                class="w-10 h-10 rounded-full bg-emerald-100 text-emerald-600"
                @click="update(rIdx, pIdx, 1)"
              >+</button>
            </div>
          </div>
        </div>

        <div
          class="mt-3 text-center font-bold"
          :class="roundSum(round) === 0
            ? 'text-emerald-600'
            : 'text-rose-600'"
        >
          합계: {{ roundSum(round) }}
        </div>
      </div>

      <div class="sticky bottom-0 bg-white border-t p-2">
        <div class="flex justify-around font-bold text-sm">
          <div v-for="(p, i) in players" class="text-center">
            <div class="text-slate-500">{{ p }}</div>
            <div>{{ playerTotal(i) }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  `
  }).mount('#app')
</script>
</body>
</html>
