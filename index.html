<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <title>score-board</title>
</head>

<body class="bg-slate-100 text-slate-800">
<div id="app" class="max-w-full"></div>

<script>
  const { createApp, ref, watch, onMounted } = Vue

  createApp({
    setup () {
      const DEFAULT_PLAYERS = ['김','이','원','안','박','허']
      const STORAGE_KEY = 'score-board-mobile-v1'

      const players = ref([...DEFAULT_PLAYERS])
      const gameStarted = ref(false)

      const createEmptyRounds = () =>
          Array.from({ length: 15 }, () =>
              Array(players.value.length).fill(0)
          )

      const rounds = ref(createEmptyRounds())

      // load
      onMounted(() => {
        const saved = localStorage.getItem(STORAGE_KEY)
        if (saved) {
          const parsed = JSON.parse(saved)
          players.value = parsed.players
          rounds.value = parsed.rounds
          gameStarted.value = parsed.gameStarted
        }
      })

      // auto save
      watch([players, rounds, gameStarted], () => {
        localStorage.setItem(
            STORAGE_KEY,
            JSON.stringify({
              players: players.value,
              rounds: rounds.value,
              gameStarted: gameStarted.value
            })
        )
      }, { deep: true })

      /* ---------- setup phase ---------- */

      const addPlayer = () => {
        players.value.push('새플레이어')
      }

      const removePlayer = (idx) => {
        if (players.value.length <= 1) {
          alert('플레이어는 최소 1명 이상이어야 합니다.')
          return
        }

        const ok = confirm(
            `"${players.value[idx]}" 플레이어를 삭제할까요?`
        )
        if (!ok) return

        players.value.splice(idx, 1)
      }

      const startGame = () => {
        if (players.value.length === 0) return
        rounds.value = createEmptyRounds()
        gameStarted.value = true
        window.scrollTo({ top: 0 })
      }

      /* ---------- game phase ---------- */

      const update = (r, p, delta) => {
        rounds.value[r][p] += delta
      }

      const roundSum = (round) =>
          round.reduce((a, b) => a + b, 0)

      const playerTotal = (idx) =>
          rounds.value.reduce((s, r) => s + r[idx], 0)

      const resetAll = () => {
        const ok = confirm(
            '게임을 종료하고 처음으로 돌아갈까요?\n(점수는 삭제됩니다)'
        )
        if (!ok) return

        players.value = [...DEFAULT_PLAYERS]
        rounds.value = createEmptyRounds()
        gameStarted.value = false
        localStorage.removeItem(STORAGE_KEY)
        window.scrollTo({ top: 0 })
      }

      return {
        players,
        rounds,
        gameStarted,
        addPlayer,
        removePlayer,
        startGame,
        update,
        roundSum,
        playerTotal,
        resetAll
      }
    },

    template: `
      <div>
        <!-- header -->
        <div class="sticky top-0 bg-white border-b z-20">
          <h1 class="text-center font-bold text-lg py-2">
            score-board
          </h1>
        </div>

        <!-- setup screen -->
        <div v-if="!gameStarted" class="p-3">
          <div class="bg-white border rounded-lg p-3">
            <div class="text-sm font-semibold mb-2">플레이어 설정</div>

            <div class="flex flex-wrap gap-2 mb-3">
              <div
                  v-for="(p, idx) in players"
                  class="flex items-center gap-1"
              >
                <input
                    v-model="players[idx]"
                    class="w-24 px-2 py-2 border rounded-md text-center text-sm"
                />
                <button
                    @click="removePlayer(idx)"
                    class="text-rose-500 text-lg px-2"
                >✕</button>
              </div>
            </div>

            <div class="flex justify-between items-center">
              <button
                  @click="addPlayer"
                  class="text-blue-600 underline text-sm"
              >
                + 플레이어 추가
              </button>

              <button
                  @click="startGame"
                  class="px-4 py-2 rounded-md
                   bg-emerald-600 text-white
                   font-medium"
              >
                게임 시작
              </button>
            </div>
          </div>
        </div>

        <!-- game screen -->
        <div v-else>
          <!-- control -->
          <div class="p-3 flex justify-center">
            <button
                @click="resetAll"
                class="px-4 py-2 rounded-md
                 border border-rose-300
                 text-rose-600 bg-white"
            >
              전체 초기화
            </button>
          </div>

          <!-- table -->
          <div class="overflow-x-auto">
            <table class="min-w-max border-separate border-spacing-y-2 px-2">
              <thead>
              <tr class="text-xs text-slate-500">
                <th class="sticky left-0 bg-slate-100 z-10 px-2">판</th>
                <th
                    v-for="p in players"
                    class="px-2 text-center"
                >
                  {{ p }}
                </th>
                <th class="sticky right-0 bg-slate-100 z-10 px-2">합</th>
              </tr>
              </thead>

              <tbody>
              <tr
                  v-for="(round, rIdx) in rounds"
                  class="bg-white border rounded-lg"
              >
                <!-- round -->
                <td class="sticky left-0 bg-white z-10 px-2 text-center font-bold">
                  {{ rIdx + 1 }}
                </td>

                <!-- scores -->
                <td
                    v-for="(_, pIdx) in players"
                    class="px-2 py-2"
                >
                  <div class="flex flex-col items-center gap-1">
                    <input
                        type="number"
                        inputmode="numeric"
                        class="w-16 h-10 text-center
                           border rounded-md text-base"
                        v-model.number="rounds[rIdx][pIdx]"
                    />

                    <div class="flex gap-2">
                      <button
                          class="w-10 h-10 rounded-full
                             bg-rose-100 text-rose-600 text-lg"
                          @click="update(rIdx, pIdx, -1)"
                      >−</button>

                      <button
                          class="w-10 h-10 rounded-full
                             bg-emerald-100 text-emerald-600 text-lg"
                          @click="update(rIdx, pIdx, 1)"
                      >+</button>
                    </div>
                  </div>
                </td>

                <!-- sum -->
                <td
                    class="sticky right-0 z-10 px-2 text-center font-bold"
                    :class="roundSum(round) === 0
                  ? 'bg-emerald-50 text-emerald-600'
                  : 'bg-rose-50 text-rose-600'"
                >
                  {{ roundSum(round) }}
                </td>
              </tr>
              </tbody>
            </table>
          </div>

          <!-- total footer -->
          <div class="sticky bottom-0 bg-white border-t p-2 z-20">
            <div class="flex justify-around text-sm font-bold">
              <div
                  v-for="(p, idx) in players"
                  class="text-center"
              >
                <div class="text-slate-500">{{ p }}</div>
                <div>{{ playerTotal(idx) }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    `
  }).mount('#app')
</script>
</body>
</html>
